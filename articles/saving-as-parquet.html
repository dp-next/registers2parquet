<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Saving the SAS databases in Parquet format • registers2parquet</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="saving-as-parquet_files/libs/quarto-html/popper.min.js"></script><script src="saving-as-parquet_files/libs/quarto-html/tippy.umd.min.js"></script><link href="saving-as-parquet_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="saving-as-parquet_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Saving the SAS databases in Parquet format">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">registers2parquet</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/design.html">Design</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dp-next/registers2parquet/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Saving the SAS databases in Parquet format</h1>




      <small class="dont-index">Source: <a href="https://github.com/dp-next/registers2parquet/blob/main/vignettes/saving-as-parquet.qmd" class="external-link"><code>vignettes/saving-as-parquet.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <p>Based on the title, I’m taking the SAS database and converting it into the Parquet format. So… what is Parquet and why did I decide to use that instead of using the standard “import the SAS data into R and use it as normal there”? This document is meant to be used as an explanation and description for the reasons and than later will show the code used to generate the results.</p>
<section class="level2"><h2 id="what-is-parquet">What is Parquet?<a class="anchor" aria-label="anchor" href="#what-is-parquet"></a>
</h2>
<p>Parquet is a data storage format, like CSV, except instead of saving data where each line is a row of a dataset (which is what CSV does) it saves it where each line in the file is a <em>column</em>. This means that all data in a variable are on a single line. Parquet also saves data in multiple files instead of one. Each file is structured based on some grouping factor. In this case, we’re keeping the same “register by year” file structure that DST has with their SAS files. This means that loading in data is faster if you for instance only want a few registers over specific periods of time.</p>
</section><section class="level2"><h2 id="why-did-i-choose-to-use-parquet">Why did I choose to use Parquet?<a class="anchor" aria-label="anchor" href="#why-did-i-choose-to-use-parquet"></a>
</h2>
<ol type="1">
<li><p>Doesn’t take up much disk space (unlike the SAS formats). This isn’t a super important reason for the person using and working with the dataset, but from a sustainability and reduced impact on the server point of view, it’s better to have a lower impact than a higher impact on resources.</p></li>
<li><p>Because of the way it is stored, reading it into R doesn’t use up much memory. Why is this a reason when the DST server has nearly 1TB of RAM memory for it’s users to use? Similar to the reason above, the less memory used, the less impact on resources (both sustainability but also from a speed perspective). And because it takes up less memory, doing work on the data is faster.</p></li>
<li><p>It can be used by multiple “structured query languages” (SQL) for doing common data wrangling tasks that is fast and that doesn’t have to import the data into memory. The typical way of working with data in R is to load the data into memory and than do the data analysis tasks. The HUGE bottle neck here, in the case of a server environment like DST, is importing the data into memory can take a pretty long time. And if you have to do it often, it quickly becomes an issue. So we can instead do some early data wrangling tasks with SQL to get the data into a smaller size that has exactly the data we want, so that our memory use is smaller and we get work done faster.</p></li>
</ol></section><section class="level2"><h2 id="save-sas-register-files-as-parquet">Save SAS register files as Parquet<a class="anchor" aria-label="anchor" href="#save-sas-register-files-as-parquet"></a>
</h2>
<p>All the code to convert the SAS files into Parquet are found in the <code>_targets.R</code> file. I’m using the targets package because it is very efficient at handling pipelines and using parallel processing. Look through that file if you are curious about it. Running the pipeline is done by using:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">targets</span><span class="fu">::</span><span class="fu">tar_make</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</section><section class="level2"><h2 id="save-other-datasets-as-parquet">Save other datasets as Parquet<a class="anchor" aria-label="anchor" href="#save-other-datasets-as-parquet"></a>
</h2>
<p>We don’t want to save every data object we create into a Parquet dataset. But some processed data we’ll end up using for several projects and that take a long time to run. In these situations, we’d want to create a Parquet dataset so we can make use of it at later points in time.</p>
<p>For now, we are saving these datasets into a Parquet dataset:</p>
<ul>
<li>The Population database, as defined by DST for our project.</li>
</ul></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luke Johnston, Signe Kirk Brødbæk.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
