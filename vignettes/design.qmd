---
title: Design
vignette: >
  %\VignetteIndexEntry{Design}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
---

## Core functionality

This is the list of the core functionality in the `registers2parquet`
package:

1.  Converts Danish register data from SAS files to the modern and
    efficient Parquet format.
2.  Provides functions to list available files (e.g., SAS or Parquet)
    directly from R, based on e.g., a specified register name or path.

## Conversion process

::: {.columns}
::: {.column}
```
bef2018.sas7bdat
bef2019.sas7bdat
bef2020.sas7bdat
bef2021.sas7bdat
bef2022.sas7bdat
December_2023/bef2022.sas7bdat
December_2023/bef2023.sas7bdat
```
:::
::: {.column}
```
bef/
├── year=2018/
│   └── part-0.parquet
├── year=2019/
│   └── part-0.parquet
├── year=2020/
│   └── part-0.parquet
├── year=2021/
│   └── part-0.parquet
├── year=2022/
│   └── part-0.parquet
└── year=2023/
    └── part-0.parquet
```
:::
:::


## Parallel processing

Each register-year pairing (including duplicate years) are sent to a separate process.
That way, rather than converting 1000+ registers one after the other, it can be split
into chunks based on the number of available CPU cores. For instance, if you set the
number of "workers" (cores) to 4, than the 1000+ registers will be split into 4 groups
and each group will be processed simultaneously on its own core.

There are some overheads to parallel processing, so it works best with a large number of
files and when the files are also relatively large, or if the processing time per file is
substantial.

## Visual representation

```{mermaid}
%%| file: flow.mmd
```

## Naming conventions

In the sections below, we outline the naming conventions of actions and
objects in the package. **Actions** are verbs that describe what a
function does, while **objects** are nouns that represent the parameters
that the functions operate on.

### Actions

| Action | Description |
|------------------------|------------------------------------------------|
| List | List or retrieve an object or multiple objects. E.g., a path, a register name, or a year from a file name. |
| registers2parquet | Convert a register SAS file (or multiple) to Parquet. |

: Actions used in `registers2parquet`.

<!-- TODO: Should the registers2parquet function be called something with the action *convert* instead? Or do we like the simplicity of it having be the same name as the package? -->

### Objects

| Object | Description |
|------------------------|------------------------------------------------|
| output_path | A path to the directory where the Parquet file created using `registers2parquet` should be written to. |
| path | A path to a file or directory. Can be a single path or multiple paths as a character vector or list. Is used in `list` functions to list available files and in `registers2parquet` to specify input files. |
| register_name | A name of a register used in the file name (without a path), e.g., "bef". Used in `list` functions to retrieve the paths of objects including that name. |

: Objects used in `registers2parquet`.

<!-- TODO: Are path and output path be relative or absolute? -->

